<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Tracker with History</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { font-family: sans-serif; margin: 0; padding: 0; }
        #map { height: 85vh; width: 100%; }
        #controls { height: 15vh; padding: 10px; background: #fff; text-align: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .status-text { font-size: 14px; color: #333; margin-bottom: 5px; }
        button { padding: 8px 15px; background: #ff4444; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="map"></div>
    <div id="controls">
        <div class="status-text" id="status">Waiting for GPS...</div>
        <button onclick="clearHistory()">Clear History</button>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const statusEl = document.getElementById('status');
        const map = L.map('map').setView([0, 0], 2);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        let marker, circle;
        let pathCoords = JSON.parse(localStorage.getItem('movePath')) || []; // Purani history load karein
        let polyline = L.polyline(pathCoords, {color: 'blue', weight: 4}).addTo(map);

        function updateLocation(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const accuracy = position.coords.accuracy;
            const newPos = [lat, lng];

            // Path update aur Save
            pathCoords.push(newPos);
            localStorage.setItem('movePath', JSON.stringify(pathCoords));
            polyline.setLatLngs(pathCoords);

            // Marker update
            if (marker) {
                marker.setLatLng(newPos);
                circle.setLatLng(newPos).setRadius(accuracy);
            } else {
                marker = L.marker(newPos).addTo(map).bindPopup("You are here").openPopup();
                circle = L.circle(newPos, { radius: accuracy }).addTo(map);
                map.setView(newPos, 16);
            }

            statusEl.textContent = `Live: ${lat.toFixed(5)}, ${lng.toFixed(5)} | Points Saved: ${pathCoords.length}`;
        }

        function clearHistory() {
            if(confirm("Kya aap rasta clear karna chahte hain?")) {
                pathCoords = [];
                localStorage.removeItem('movePath');
                polyline.setLatLngs([]);
                statusEl.textContent = "History cleared.";
            }
        }

        function handleError(error) {
            statusEl.textContent = "Error: " + error.message;
        }

        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(updateLocation, handleError, {
                enableHighAccuracy: true,
                maximumAge: 2000
            });
        }
    </script>
</body>
</html>
